@page "/dbtool";
@using ProjMngWasm.Models;
@using ProjMngWasm.Services;

<RadzenCard class="rz-my-6">
  <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Wrap="FlexWrap.Wrap">        
    <RadzenStack Orientation="Orientation.Vertical" Gap="4px">
      <RadzenTextBox  />
    </RadzenStack>
    <RadzenStack Orientation="Orientation.Vertical" Gap="4px">
      <RadzenButton Click="@OnLoad" Text="Search"></RadzenButton>
    </RadzenStack>
  </RadzenStack>
</RadzenCard>


<RadzenCard class="rz-my-6">

  <RadzenRow JustifyContent="JustifyContent.Normal" AlignItems="AlignItems.Normal" >
    <RadzenColumn Size="3">
      <RadzenDataGrid Style="height: 500px" @bind-Value=@selectedItems
                      Data="@data"
        TItem="IDictionary<string, object>" ColumnWidth="550px"
        AllowFiltering="true" 
        FilterPopupRenderMode="PopupRenderMode.OnDemand" 
        FilterMode="FilterMode.Advanced" 
        AllowPaging="false" 
        AllowSorting="true"
        PagerHorizontalAlign="HorizontalAlign.Left" 
        ShowPagingSummary="true">
        <Columns>
          <RadzenDataGridColumn title="ProcName" >
            <Template>
              @context["ProcedureName"]
            </Template>
          </RadzenDataGridColumn>    
        </Columns>
      </RadzenDataGrid>
    </RadzenColumn>
    <RadzenColumn Size="9">
      <pre Style="height: 500px" >
        @selectedItems?[0]["ROUTINE_DEFINITION"]
  </pre>
      
    </RadzenColumn>
  </RadzenRow>

</RadzenCard>



@code {


  [Inject] protected IJsiniService JsiniService { get; set; }

  IList<IDictionary<string, object>> selectedItems;

  public IEnumerable<IDictionary<string, object>> data { get; set; }

  
protected async Task OnLoad() {
    data = await JsiniService.GetList("db", new Dictionary<string, object>() { });
}


protected override async Task OnInitializedAsync() {
    await base.OnInitializedAsync();
  }
}
